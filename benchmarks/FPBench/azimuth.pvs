azimuth: THEORY
BEGIN
IMPORTING PRECiSA@ieee754_double

% @fp-function
azimuth(Lat1,Lon1,Lat2: double,Lon2: double
  | (Dcos(Lat1) * Dsin(Lat2)) - (Dsin(Lat1) * Dcos(Lat2) * Dcos(Lon2-Lon1)) /= 0):double =
  LET DLon = Lon2 - Lon1 IN
  LET Y = Dcos(Lat2) *  Dsin(DLon) IN
  LET X = (Dcos(Lat1) * Dsin(Lat2)) - (Dsin(Lat1) * (Dcos(Lat2) * Dcos(DLon))) IN
  Datan(Y/X)

END azimuth